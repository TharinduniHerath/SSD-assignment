## Terminal Testing: Vulnerabilities 10â€“12

Run all commands from the backend directory unless noted.

Prereqs
```bash
cd /Users/dhanushikan/Documents/GitHub/SSD-assignment/backend
npm install
npm run dev
```

Vulnerability 12: X-Powered-By removed + security headers (Helmet)
```bash
# Check headers on HTTP (root may be 404, that is OK)
curl -I http://localhost:4000 | sed -n '1,999p'
# Expect NOT to see: X-Powered-By
# Expect to see: Content-Security-Policy, X-Frame-Options: DENY, X-Content-Type-Options: nosniff
```

Vulnerability 11: Secure uploads (MIME whitelist, 5MB limit, sanitized names)
```bash
# Allowed (should be 200)
curl -s -o /dev/null -w "%{http_code}\n" -X POST http://localhost:4000/api/upload/image \
  -F "image=@/Users/dhanushikan/Documents/GitHub/SSD-assignment/frontend/src/assets/noProducts.png"

# Disallowed type (should be 400)
echo "malicious" > /tmp/bad.exe
curl -s -o /dev/null -w "%{http_code}\n" -X POST http://localhost:4000/api/upload/image \
  -F "image=@/tmp/bad.exe"

# Oversize (should be 400)
truncate -s 6M /tmp/big.jpg
curl -s -o /dev/null -w "%{http_code}\n" -X POST http://localhost:4000/api/upload/image \
  -F "image=@/tmp/big.jpg"
```

Vulnerability 10: HTTPS + HSTS (dev HTTPS optional)
```bash
# Generate local certs (from backend dir)
openssl req -x509 -nodes -newkey rsa:2048 -keyout key.pem -out cert.pem -days 1 -subj "/CN=localhost"

# Ensure .env contains HTTPS settings
cat >> .env << 'EOF'
HTTPS_PORT=4443
SSL_CERT_PATH=./cert.pem
SSL_KEY_PATH=./key.pem
EOF

# Restart server
echo "Restart the server in another terminal: npm run dev"

# Verify HTTPS responds (ignore self-signed via -k)
curl -kI https://localhost:4443 | sed -n '1,999p'

# HSTS only in production
NODE_ENV=production node server.js &
sleep 1
curl -kI https://localhost:4443 | grep -i strict-transport
kill %1
```

```bash
# View served certificate via TLS handshake
openssl s_client -connect localhost:4443 -servername localhost -showcerts </dev/null

# OPTIONAL: Open a local certificate in Keychain Access GUI (if created as ~/localhost.crt)
open -a "Keychain Access" ~/localhost.crt
```

Notes
- If uploads return 200 for allowed and 400 for disallowed/oversize, Vuln 11 passes.
- If no X-Powered-By and Helmet headers present, Vuln 12 passes.
- If HTTPS responds, and HSTS appears in prod mode, Vuln 10 passes.


